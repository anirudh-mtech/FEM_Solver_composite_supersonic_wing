clc
clear all
%find the coefficients
n=48;
n1=50;
x=0:1/(n-1):1;
y=0:1/(n):0.999;
x1=0:1/(n1-1):1;
y1=0.001:1/n1:0.999;
S_upper=zeros(n,n);
S_lower=zeros(n,n);
thickness_of_trailing_edge_lower_guess=1e-4;
for i=1:n
    S_upper(i,1:n)=(factorial(n)/(factorial(n-i)*factorial(i)))*(((x).^i).*((ones(1,n)-x).^(n-i)));
end
for i=1:n1
    S_lower(i,1:n1)=(factorial(n1)/(factorial(n1-i)*factorial(i)))*(((x1).^i).*((ones(1,n1)-x1).^(n1-i)));
end
iterations=5;
z=[0.000000  0.000000;
  0.002000  0.009500;
  0.005000  0.015800;
  0.010000  0.021900;
  0.020000  0.029300;
  0.030000  0.034300;
  0.040000  0.038100;
  0.050000  0.041100;
  0.070000  0.046200;
  0.100000  0.051800;
  0.120000  0.054800;
  0.150000  0.058500;
  0.170000  0.060600;
  0.200000  0.063200;
  0.220000  0.064600;
  0.250000  0.066400;
  0.270000  0.067300;
  0.300000  0.068500;
  0.330000  0.069200;
  0.350000  0.069600;
  0.380000  0.069800;
  0.400000  0.069700;
  0.430000  0.069500;
  0.450000  0.069200;
  0.480000  0.068400;
  0.500000  0.067800;
  0.530000  0.066600;
  0.550000  0.065600;
  0.570000  0.064500;
  0.600000  0.062500;
  0.620000  0.061000;
  0.650000  0.058500;
  0.680000  0.055500;
  0.700000  0.053300;
  0.720000  0.050900;
  0.750000  0.046900;
  0.770000  0.043900;
  0.800000  0.038900;
  0.820000  0.035300;
  0.850000  0.029400;
  0.870000  0.025100;
  0.900000  0.018100;
  0.920000  0.013100;
  0.950000  0.004900;
  0.970000 -0.000900;
  0.980000 -0.003900;
  0.990000 -0.007100;
  1.000000 -0.010400;
  ];
z_lower=[0.000000  0.000000;
  0.002000 -0.009300;
  0.005000 -0.016000;
  0.010000 -0.022100;
  0.020000 -0.029500;
  0.030000 -0.034400;
  0.040000 -0.038100;
  0.050000 -0.041200;
  0.070000 -0.046200;
  0.100000 -0.051700;
  0.120000 -0.054700;
  0.150000 -0.058500;
  0.170000 -0.060600;
  0.200000 -0.063300;
  0.220000 -0.064700;
  0.250000 -0.066600;
  0.280000 -0.068000;
  0.300000 -0.068700;
  0.320000 -0.069200;
  0.350000 -0.069600;
  0.370000 -0.069600;
  0.400000 -0.069200;
  0.420000 -0.068800;
  0.450000 -0.067600;
  0.480000 -0.065700;
  0.500000 -0.064400;
  0.530000 -0.061400;
  0.550000 -0.058800;
  0.580000 -0.054300;
  0.600000 -0.050900;
  0.630000 -0.045100;
  0.650000 -0.041000;
  0.680000 -0.034600;
  0.700000 -0.030200;
  0.730000 -0.023500;
  0.750000 -0.019200;
  0.770000 -0.015000;
  0.800000 -0.009300;
  0.830000 -0.004800;
  0.850000 -0.002400;
  0.870000 -0.001300;
  0.890000 -0.000800;
  0.920000 -0.001600;
  0.940000 -0.003500;
  0.950000 -0.004900;
  0.960000 -0.006600;
  0.970000 -0.008500;
  0.980000 -0.010900;
  0.990000 -0.013700;
  1.000000 -0.016300];
lower_curve=zeros(1,n1);
%coefficients_lower=lsqr(S_lower,(ones(n1,1)-(z_lower(1:n1,1)*thickness_of_trailing_edge_lower_guess)));
 %for i=1:iterations
 %if abs(abs(lower_curve-(z_lower(1:end,2))')./abs(y1(1:end,2)'))<(1e-02*ones(1,n1))
 %        disp("done")
 %        break
 %    else
 % hell=pinv(S_lower);
 coefficients_lower=lsqr(S_lower,(z_lower(1:end,2)-(thickness_of_trailing_edge_lower_guess))); 
 %end
 %thickness_of_trailing_edge_lower_guess=thickness_of_trailing_edge_lower_guess+0.1;
 lower_curve=((coefficients_lower'*S_lower).*((((((z_lower(1:n1,1)).^0.75)').*((ones(n1,1)-((z_lower(1:n1,1))))'.^0.75)))./((ones(n1,1)-(z_lower(1:n1,1)*thickness_of_trailing_edge_lower_guess))')));
 %tolerance=abs(abs(lower_curve-(z_lower(1:end,2))')./abs(z_lower(1:end,2)'));
 %end
 %curve_upper=fit(z(1:end,1),z(1:end,2),"poly9");
 %curve_lower=fit(z(1:end,1),z(1:end,2),"poly9");
% upper_curve=1.567*z(1:end,1).^5-4.544*z(1:end,1).^4+4.782*z(1:end,1).^3-2.417*z(1:end,1).^2+0.5905*z(1:end,1)-0.01289;
% lower_curve=-(1.567*z_lower(1:end,1).^5-4.544*z_lower(1:end,1).^4+4.782*z_lower(1:end,1).^3-2.417*z_lower(1:end,1).^2+0.5905*z_lower(1:end,1)-0.01289);
%plot(z(1:end,1),upper_curve,"r")
 %hold on
 %plot(z(1:end,1),z(1:end,2),"ro")
%   plot(z_lower(1:end,1),z_lower(1:end,2),"bo")
%   hold on
%   plot(z_lower(1:end,1),lower_curve,"b")
%   hold off
 %hold off
%  lower_curve=coefficients_lower*S_lower;
 plot(z_lower(1:n1,1),lower_curve',"b")
 hold on
 plot(z_lower(1:n1,1),z_lower(1:n1,2),"bo")
 hold off
